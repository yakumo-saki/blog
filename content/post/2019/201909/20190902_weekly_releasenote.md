---
type: post
title:  "2019/09/02 Week Release Note"
date:   2019-09-02 09:01:23 +0900
tags:
  - releasenote
---
# 雑感

* そろそろ転職活動しないとヤバい。

## 9/2

### dockbix-agent に接続

k8s外のzabbix-serverからk8s上のagentに接続するってどうすれば･･･
serviceを定義すれば繋がるだろうけれども、daemonsetに対してservice定義するってなんかとっても違う気がする。

結局Ansibleを誤爆してしまい、ワーカーに直接zabbix-agentを入れることに。

## 9/3

### zabbixサーバーの移転

Jetson Nanoがzabbixサーバーやってるのはおかしい（色んな意味で）ので、余っていたRaspberryPi 3Bに移動した。
バージョンが違っていて辛かった。 (arm64はVer 4.2、armは4.0が最新)
PostgreSQLに移行しようなんて思ったせいでさらに時間がかかり･･･結局mysqlのママにしたという。
arm64等では 4.2がでているけれども、armは4.0で止まっている。DBのschemaが違って怒られたので、
dbversionを無理矢理4000000に書き換えて動かした。

### kanikoを使ったイメージのビルド

メモリを2.5Giほど割り当てると成功することが分かった。(テストはWriteFreelyのイメージで行った）
DockerHubへのアップロードも成功しているようだ（動作は見ていない）

### Misskey自動アップグレード

Mastodonのを流用すれば楽だろうと思ったら（事実楽な部分は多い。例えば、Misskeyは起動時に自動的にdb:migrateされるとか）
･･･見事にハマっている。misskeyのバージョンは 11.x.y だけれども、 11.9.1 > 11.31.4 と判定されてしまって、
見事に失敗した。 明日何か考えよう。

### オイルヒーター

粗大ゴミに出した。

## 9/4

### Raspberry Pi 3B arm64化

Ubuntu 18.04LTS (arm64) を動かすことでaarch64モードで実行できる事を知ったので切り替え。
これが大変だった。 Qiitaの手順や、公式の手順でもUSB-SSDから起動することができない。
色々と試したが、どうにもらちがあかないので諦めてmicroSDカードから起動させて、
cmdline.txt の rootfs の指定をUSB-SSDにすることで、実質SSDから起動するようにした。

### ラズパイのヒートシンク

純正ケースに入っているんだけれども、swapなしの状態でMysqlのdumpをロードしたらそれはそれは･･･
ひどい目にあった。ラズパイの画面に温度計が表示されるのは初めてみた。
即Amazonで注文したけれども届くのは金曜日。あーあ。

## 9/5

### zabbixのアラートスクリプト類のレストア

この部分、 githubに上げてる docker-compose に反映した。

### misskey自動アップグレード

毎度毎度 sed のアレを組み立てるのはめんどい。
https://qiita.com/yakumo/items/46fef0bca043bd350e2b

### ものほし竿増設

洗濯物を溜めると足りなかったので買ってきた。お値段500円未満。おねだん以上

## 9/6 

### kaniko Mastodonに適用

適用した。

### 書類仕事

電気通信事業者、登録すると一覧が公表されるとかなんとからしいので保留。

# TODO

## k8sに移動したことによって壊れている単純なジョブの修正

- [x] バックアップ
- [x] テストインスタンスバックアップ
- [x] misskeyインスタンスバックアップ
- [x] 財団バックアップ
- [ ] 統計情報取得（DB部分）
- [x] sidekiq統計取得 
- [x] 週次メンテナンスジョブ
- [x] 月次メンテナンスジョブ

## k8sの仕組みでオートデプロイ再構築
- [ ] fastladder
- [ ] writefreely
- [x] misskey
- [x] テストインスタンス
- [x] 本番インスタンス

## writefreely への文書コピー

本当にコピー

## 職務経歴書

- [x] 外枠（プロジェクト名と日付）
- [ ] フォーマット統一
- [ ] プロジェクトの中身 (2018)
- [ ] プロジェクトの中身 (2017)
- [ ] プロジェクトの中身 (2016)
- [ ] プロジェクトの中身 (2015)
- [ ] プロジェクトの中身 (2014)
- [ ] プロジェクトの中身 (2013)
- [ ] プロジェクトの中身 (2012)
- [ ] プロジェクトの中身 (2011)
- [x] プロジェクトの中身 (2011より前)
- [ ] 自己PR

進捗ありません！

## 痩せる

- [ ] プールに行って泳ぐ

