---
title: オブジェクトストレージいれた
author: 八雲
type: post
date: 2018-07-03T04:16:15+00:00
url: /2018/07/2642
tags:
  - 日記

---
## 前説

最近、mastodonのインスタンスを動かしてる都合で、S3互換ストレージを
  
家のサーバーで動かしている。このblogのホストも家のサーバーに移動していて
  
せっかくなので、S3互換ストレージ（minioを使っています。以下S3）にブログの画像とかを移動したい
  
と思った次第。
  
＃実は、このblogの画像データを一回飛ばした事があって、
  
＃一部の記事の画像データがロストしているので、できるだけ大事なものは
  
＃一箇所に集めておきたいっていう事情がある

## 使ってるプラグイン

Media Cloud プラグインを使ってます。
  
php動かしてるサーバー上のファイルを自動的にS3にアップロードする機能もあるのに
  
フリー。設定がちょっと面倒だけれども、ちゃんと動きます。

## ハマったところ１（リージョン）

FAQにも書いてありますが、minioを使っている場合は、minioの設定でREGIONを必ずセットせよ
  
とのこと。 us-east-1 にセット済みだったのだけれども、プラグインの設定では、地名が
  
表示されていて、どれがどうだかわからない。us-east-1 は US East (N. Virginia) のようです。

## Custom Endpoint URL

minioのAPIのEndpointを正しく設定しないと動きません。そりゃそうですね。

## デバッグ

https://papertrailapp.com/ でアカウントを作って（無料アカウントで十分）おくと、
  
ログを飛ばすことができる。結構なログが出ているので便利。
  
リージョン間違えてるのも、ここでログをみてわかった。
